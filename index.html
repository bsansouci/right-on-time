<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="./client.js"></script>
</head>
<body style="width: 1000px;height:1000px;position: absolute;">
<button id="play-button" disabled>Load!</button>

<script>
    var socket = io.connect('http://192.168.1.101:8080');
    var play = null;
    socket.on('server-ready', function (data) {
      var music = new WebAudioAPISound("music/rider-in-red", function() {
        console.log("Done loading.");

        document.getElementById("play-button").disabled = false;
        document.getElementById("play-button").addEventListener('click', function () {
          document.getElementById("play-button").textContent = "Play";
          // Start playing audio when the user clicks anywhere on the page,
          // to force Mobile Safari to load the audio.
          document.getElementById("play-button").removeEventListener('click', arguments.callee, false);

          music.play(0);
          music.stop(0);

          var play = function() {
            var timestamp = Date.now() + 2000;
            socket.emit("play", timestamp);
            music.play(timestamp - Date.now());
            var div = document.createElement("div");
            div.textContent = timestamp + " | " + (timestamp - Date.now());
            document.body.appendChild(div);
          };

          socket.on("play", function(timestamp) {
            console.log(timestamp, Date.now() - timestamp);

            music.play(timestamp - Date.now());
            var div = document.createElement("div");
            div.textContent = timestamp + " | " + (timestamp - Date.now());
            document.body.appendChild(div);
          });

          document.getElementById("play-button").addEventListener('click', play, false);
        }, false);

      });

    });
  </script>
</body>
</html>